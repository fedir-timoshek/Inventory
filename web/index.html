<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ICS Inventory Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-client-id" content="180993117826-pnc9bkd8fg3s29hu8ru612cqg0gmk3ld.apps.googleusercontent.com">
  <meta name="api-url" content="https://script.google.com/macros/s/AKfycbwYC0GUHal94AIuNX_gTHJUlV4VJm6hFgxa9nJb64ipeh490KPhSfSGKwL4duu4Oh8Vrg/exec">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- ZXing UMD build for browser barcode scanning -->
  <script src="https://unpkg.com/@zxing/library@0.20.0/umd/index.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="loadingScreen" class="loading-screen" aria-live="polite" aria-busy="true">
    <div class="loading-card">
      <div class="loading-brand">
        <div class="brand-logo" aria-hidden="true">ICS</div>
        <div>
          <div class="loading-title">Inventory Scanner</div>
          <div id="loadingStatus" class="loading-status">Checking session...</div>
        </div>
      </div>
      <div class="loading-bar"><span></span></div>
      <div class="loading-foot">Preparing secure sign-in</div>
    </div>
    <div class="loading-orb orb-1" aria-hidden="true"></div>
    <div class="loading-orb orb-2" aria-hidden="true"></div>
  </div>
  <div id="authScreen" class="auth-screen hidden" aria-live="polite">
    <div class="auth-card">
      <div class="section-title">Sign in</div>
      <div class="section-sub">Use your Google account to continue.</div>
      <div id="googleSignInButton"></div>
      <div id="authError" class="muted hidden"></div>
    </div>
  </div>
  <div class="app-shell">
    <div class="app-container">
      <header class="app-header">
        <div class="brand">
          <div class="brand-logo" aria-hidden="true">ICS</div>
          <div class="brand-text">
            <h1>ICS Inventory</h1>
            <p>Scan &amp; register items into Google Sheets</p>
          </div>
        </div>
        <div class="header-actions">
          <div id="userBadge" class="user-badge" title="Signed-in user"></div>
          <button id="btnSignOut" type="button" class="btn btn-ghost btn-compact hidden">Sign out</button>
        </div>
      </header>

      <nav class="tab-bar" aria-label="Main views">
        <button id="tabScan" class="tab-button tab-active" type="button">Scan</button>
        <button id="tabEntries" class="tab-button" type="button">Entries</button>
      </nav>

      <!-- Scan Screen -->
      <main id="screenScan" class="screen screen-active" role="tabpanel" aria-labelledby="tabScan">
        <section class="card">
          <form id="itemForm" class="stack" novalidate>
            <div class="field">
              <label for="inputBarcode">Barcode</label>
              <div class="field-row">
                <input id="inputBarcode" type="text" autocomplete="off" placeholder="Scan or type barcode" inputmode="numeric" class="pill-input grow">
                <button id="btnOpenScanner" type="button" class="btn btn-primary shrink">üì∑ Scan</button>
              </div>
            </div>

            <div class="field">
              <label for="selectRoom">Location</label>
              <div class="field-row">
                <div id="roomDisplay" class="pill-input readonly grow" tabindex="0">Select a room</div>
                <button id="btnOpenRoomSheet" type="button" class="btn btn-primary shrink">üìç Pick</button>
              </div>
              <select id="selectRoom" class="hidden-select">
                <option value="">Choose room‚Ä¶</option>
              </select>
            </div>

            <div class="field">
              <label>Picture</label>
              <div class="media-wrap">
                <div class="stack">
                  <button id="takePhotoButton" type="button" class="btn btn-ghost">üì∑ Take picture</button>
                  <button id="choosePhotoButton" type="button" class="btn btn-ghost">üñº Upload image</button>
                </div>
                <div class="preview-box">
                  <div style="width:100%;">
                    <img id="imagePreview" class="image-preview hidden" alt="Selected item image preview">
                    <div id="removeImageButton" class="remove-image-link hidden">Remove image</div>
                    <div id="imagePlaceholder" class="muted">Preview</div>
                  </div>
                </div>
              </div>
              <input id="takePhotoInput" type="file" accept="image/*" capture="environment" class="hidden">
              <input id="choosePhotoInput" type="file" accept="image/*" class="hidden">
            </div>

            <div class="field">
              <label for="inputQuantity">Quantity</label>
              <div class="field-row quantity-row">
                <button id="btnQtyMinus" type="button" class="btn btn-ghost shrink">-</button>
                <input id="inputQuantity" type="number" min="1" step="1" value="1" inputmode="numeric" class="pill-input quantity-input" aria-label="Quantity">
                <button id="btnQtyPlus" type="button" class="btn btn-ghost shrink">+</button>
              </div>
            </div>

            <div class="field">
              <label for="inputNotes">Notes</label>
              <textarea id="inputNotes" placeholder="Notes, description, condition..." class="pill-input"></textarea>
            </div>

            <div class="actions-bar">
              <div class="actions-grid">
                <button id="btnSaveItem" type="submit" class="btn btn-primary">üíæ Save item</button>
                <button id="btnClearForm" type="button" class="btn btn-ghost">‚ú® Clear form</button>
                <button id="btnSyncScan" type="button" class="btn btn-ghost">‚§¥ Sync queued items</button>
              </div>
            </div>

            <div id="offlineBadge" class="muted hidden">‚ö† Offline queue: <span id="offlineBadgeCount">0</span> item(s) waiting to sync</div>
          </form>
        </section>
      </main>

      <!-- Entries Screen -->
      <main id="screenEntries" class="screen" role="tabpanel" aria-labelledby="tabEntries">
        <section class="card" aria-label="Recent entries">
          <div class="section-title">Entries</div>
          <div class="entries-header">
            <input id="searchInput" type="text" placeholder="Search by barcode, room or notes‚Ä¶" class="pill-input grow">
            <button id="btnRefreshEntries" type="button" class="btn btn-ghost shrink">‚ü≥ Refresh</button>
            <button id="btnSyncEntries" type="button" class="btn btn-ghost shrink">‚§¥ Sync queued</button>
          </div>

          <div id="adminBar" class="muted" style="display:none;">
            <strong>Admin</strong> mode enabled
            <label style="margin-left:8px; display:inline-flex; align-items:center; gap:6px;">
              <input type="checkbox" id="adminModeToggle">
              <span>Toggle</span>
            </label>
          </div>

          <div id="entriesList" class="entries-list" aria-live="polite"></div>
        </section>
      </main>
    </div>
  </div>

  <!-- Scanner Sheet -->
  <div id="scannerSheet" class="sheet" aria-hidden="true">
    <div id="scannerSheetBackdrop" class="sheet-backdrop"></div>
    <div id="scannerSheetPanel" class="sheet-panel" role="dialog" aria-modal="true" aria-label="Barcode scanner">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <div>
          <h3>Scan barcode</h3>
          <p>Hold the code in the frame</p>
        </div>
        <button id="btnCloseScannerSheet" type="button" class="btn">‚úï</button>
      </div>
      <div class="sheet-body">
        <div id="cameraSupportMessage" class="muted hidden">
          Camera scanning is not available in this browser. You can still type barcodes manually.
        </div>
        <div id="videoShell" class="video-shell">
          <video id="videoPreview" playsinline muted></video>
          <div class="scan-frame" aria-hidden="true"></div>
        </div>
        <div class="scan-status-strip">
          <div id="scanStatus">Camera off</div>
          <div id="scanStatusBadge" class="scan-status-badge">Idle</div>
        </div>
        <div class="field-row" style="margin-top:8px; flex-wrap:wrap;">
          <label class="muted" style="display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="continuousToggle"> Continuous
          </label>
          <div id="cameraSelectRow" class="muted hidden" style="display:flex; align-items:center; gap:6px;">
            <span>Camera</span>
            <select id="cameraSelect" class="pill-input" style="min-width:170px; min-height:44px; padding:10px 12px; border-radius:12px; border:1px solid var(--border);"></select>
          </div>
        </div>
        <div id="torchRow" class="torch-row">
          <button id="btnStopScan" type="button" class="btn btn-ghost">‚ñ† Stop</button>
          <button id="btnToggleTorch" type="button" class="btn btn-ghost">üî¶ Flashlight</button>
          <span id="torchHint" class="torch-badge">Not supported</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Rooms Sheet -->
  <div id="roomSheet" class="sheet" aria-hidden="true">
    <div id="roomSheetBackdrop" class="sheet-backdrop"></div>
    <div id="roomSheetPanel" class="sheet-panel" role="dialog" aria-modal="true" aria-label="Choose room">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <div>
          <h3>Choose room</h3>
          <p>Select a location</p>
        </div>
        <button id="btnCloseRoomSheet" type="button" class="btn">‚úï</button>
      </div>
      <div id="roomList" class="sheet-body stack"></div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="app.js" type="module"></script>
</body>
</html>
